# 9. value\_counts() and groupby()

{% embed url="https://youtu.be/vsMhER6zZTU" %}

## Download Dataset:

{% file src="../../.gitbook/assets/bmw.csv" %}

## value\_counts() and groupby() in pandas

value\_counts() and groupby() in pandas are used to summarize the whole data to find meaningful insights.

Suppose you work for bmw and you are given a dataset to find meaningful information. You may use value\_counts() and groupby() to find meaningful information out of it.

```python
# read dataset
import pandas as pd
df = pd.read_csv('bmw.csv')
df.head()
```

Out:

|    | model    | year | price | transmission | mileage | fuelType | tax |  mpg | engineSize |
| -: | -------- | ---: | ----: | ------------ | ------: | :------: | --: | ---: | ---------: |
|  0 | 2 Series | 2018 | 16250 | Manual       |   10401 |  Petrol  | 145 | 52.3 |        1.5 |
|  1 | 5 Series | 2014 | 11200 | Automatic    |   67068 |  Diesel  | 125 | 57.6 |        2.0 |
|  2 | 6 Series | 2018 | 27000 | Automatic    |   14827 |  Petrol  | 145 | 42.8 |        2.0 |
|  3 | 5 Series | 2016 | 16000 | Automatic    |   62794 |  Diesel  | 160 | 51.4 |        3.0 |
|  4 | 1 Series | 2017 | 12750 | Automatic    |   26676 |  Diesel  | 145 | 72.4 |        1.5 |

***

### value\_counts()

value\_counts() is used to count the unique values in a column.

#### transmission

How many types of transmission did BMW introduce?

```python
df['transmission'].value_counts()
```

Out:

transmission\
Semi-Auto 4666\
Automatic 3588\
Manual 2527\
Name: count, dtype: int64

Insight: Semi-Auto (4666) is the highest and Manual (2527) is the lowest.

{% stepper %}
{% step %}
Note 1:

value\_counts() always gives values in descending order.
{% endstep %}

{% step %}
Note 2:

When you value\_counts() a column, the values become the index.
{% endstep %}
{% endstepper %}

#### normalize = True

Convert counts to proportions:

```python
df['transmission'].value_counts(normalize=True)
```

Out:

transmission\
Semi-Auto 0.432798\
Automatic 0.332808\
Manual 0.234394\
Name: proportion, dtype: float64

Insight: BMW manufactured \~0.43 Semi-Auto cars of all cars.

#### Convert to percentage

```python
df['transmission'].value_counts(normalize=True) * 100
```

Out:

transmission\
Semi-Auto 43.279844\
Automatic 33.280772\
Manual 23.439384\
Name: proportion, dtype: float64

Insight: BMW manufactured 43% Semi-Auto cars.

***

### Different Scenarios of value\_counts

#### sort = False

```python
df['transmission'].value_counts(sort=False)
```

Out:

transmission\
Manual 2527\
Automatic 3588\
Semi-Auto 4666\
Name: count, dtype: int64

#### sort\_index()

```python
df['transmission'].value_counts().sort_index()
```

Out:

transmission\
Automatic 3588\
Manual 2527\
Semi-Auto 4666\
Name: count, dtype: int64

#### reset\_index()

```python
df['transmission'].value_counts().reset_index()
```

Out:

|    | transmission | count |
| -: | ------------ | ----: |
|  0 | Semi-Auto    |  4666 |
|  1 | Automatic    |  3588 |
|  2 | Manual       |  2527 |

***

### Counting Multiple Values with value\_counts()

#### year and transmission

```python
df[['year','transmission']].value_counts()
```

Out (truncated):

year transmission\
2019 Semi-Auto 2005\
Automatic 997\
2016 Automatic 736\
2017 Semi-Auto 672\
...\
Name: count, dtype: int64

Insight: 2019 has the highest number of Semi-Auto cars.

#### normalize = True (proportions)

```python
df[['year','transmission']].value_counts(normalize=True)
```

Out (truncated; proportions):

year transmission\
2019 Semi-Auto 0.185975\
Automatic 0.092478\
2016 Automatic 0.068268\
...\
Name: proportion, dtype: float64

#### percentage

```python
df[['year','transmission']].value_counts(normalize=True) * 100
```

Out (truncated; percentages):

year transmission\
2019 Semi-Auto 18.597533\
Automatic 9.247751\
2016 Automatic 6.826825\
...\
Name: proportion, dtype: float64

Insight: 18% of Semi-Auto cars were produced in 2019 — the highest.

#### sort\_index()

You can sort by both indexes:

```python
mdf = df[['year','transmission']].value_counts(normalize=True) * 100
mdf = mdf.sort_index()
mdf
```

Out (truncated):

year transmission\
1996 Automatic 0.009276\
1997 Manual 0.009276\
1998 Manual 0.009276\
1999 Automatic 0.009276\
1999 Manual 0.027827\
...\
2020 Semi-Auto 5.509693\
Name: proportion, dtype: float64

#### reset\_index()

```python
mdf = df[['year','transmission']].value_counts(normalize=True) * 100
mdf = mdf.reset_index()
mdf
```

Out (truncated):

|     | year | transmission | proportion |
| --: | ---: | ------------ | ---------: |
|   0 | 2019 | Semi-Auto    |  18.597533 |
|   1 | 2019 | Automatic    |   9.247751 |
|   2 | 2016 | Automatic    |   6.826825 |
|   3 | 2017 | Semi-Auto    |   6.233188 |
|   4 | 2017 | Automatic    |   5.973472 |
| ... |      |              |            |

#### sort by year and proportion

```python
mdf = mdf.sort_values(['year','transmission'], ascending=[True, False])
mdf
```

Out (truncated, sorted):

|     | year | transmission | proportion |
| --: | ---: | ------------ | ---------: |
|  49 | 1996 | Automatic    |   0.009276 |
|  52 | 1997 | Manual       |   0.009276 |
|  51 | 1998 | Manual       |   0.009276 |
|  40 | 1999 | Manual       |   0.027827 |
| ... |      |              |            |
|  21 | 2020 | Automatic    |   0.704944 |

Insight: Shows top manufactured transmission cars in each year.

***

## Groupby in Pandas

Groupby is used to group column(s) and perform aggregate functions.

Syntax:

```python
df.groupby(groupby_col).agg( variable = (operation_col, operation) )
```

### Single-column groupby

#### Average mileage per transmission

```python
mdf = df.groupby('transmission').agg(avg_mileage = ('mileage','mean'))
mdf
```

Out:

| transmission | avg\_mileage |
| :----------: | -----------: |
|   Automatic  | 31830.679487 |
|    Manual    | 34720.485160 |
|   Semi-Auto  | 15631.347621 |

Note: groupby makes the grouping column the index. Use reset\_index() to get it back as a column.

```python
mdf = df.groupby('transmission').agg(avg_mileage = ('mileage','mean')).reset_index()
mdf
```

Out:

|    | transmission | avg\_mileage |
| -: | ------------ | -----------: |
|  0 | Automatic    | 31830.679487 |
|  1 | Manual       | 34720.485160 |
|  2 | Semi-Auto    | 15631.347621 |

#### sort avg\_mileage to find best mileage transmission

```python
mdf = mdf.sort_values('avg_mileage', ascending=False)
mdf
```

Out:

| transmission | avg\_mileage |
| :----------: | -----------: |
|    Manual    | 34720.485160 |
|   Automatic  | 31830.679487 |
|   Semi-Auto  | 15631.347621 |

Insight: Manual cars have the highest average mileage.

#### model count, average, median per transmission

```python
mdf = df.groupby('transmission').agg(
    avg_mileage = ('mileage','mean'),
    median_mileage = ('mileage','median'),
    car_count = ('model','count')
)
mdf = mdf.sort_values('median_mileage', ascending=False)
mdf
```

Out:

| transmission | avg\_mileage | median\_mileage | car\_count |
| :----------: | -----------: | --------------: | ---------: |
|    Manual    |  34720.48516 |         30000.0 |       2527 |
|   Automatic  |  31830.67949 |         26193.5 |       3588 |
|   Semi-Auto  |  15631.34762 |          9036.5 |       4666 |

Insight: Median mileage for Manual is \~30000; Semi-Auto \~9000.

#### multiple aggregates per transmission

```python
mdf = df.groupby('transmission').agg(
    model_count = ('model','count'),
    total_price = ('price','sum'),
    avg_price = ('price','mean'),
    median_price = ('price','median'),
    max_price = ('price','max'),
    min_price = ('price','min'),
    avg_engine_size = ('engineSize','mean'),
)
mdf
```

Out:

| transmission | model\_count | total\_price |   avg\_price | median\_price | max\_price | min\_price | avg\_engine\_size |
| :----------: | -----------: | -----------: | -----------: | ------------: | ---------: | ---------: | ----------------: |
|   Automatic  |         3588 |     80439458 | 22419.023969 |       19490.0 |      99950 |       1200 |          2.258250 |
|    Manual    |         2527 |     36988839 | 14637.451128 |       13500.0 |      46000 |       1445 |          1.837594 |
|   Semi-Auto  |         4666 |    127660584 | 27359.747964 |       24990.0 |     123456 |       5299 |          2.277004 |

#### Best fuel type for mileage

```python
mdf = df.groupby('fuelType').agg(
    avg_mileage = ('mileage','mean'),
    median_mileage = ('mileage','median'),
).sort_values('avg_mileage', ascending=False)
mdf
```

Out:

| fuelType | avg\_mileage | median\_mileage |
| :------: | -----------: | --------------: |
|   Other  | 44760.638889 |         44351.5 |
|  Diesel  | 29852.804042 |         24600.0 |
|  Hybrid  | 23400.530201 |         16900.0 |
| Electric | 19925.333333 |         20321.0 |
|  Petrol  | 16524.097454 |          9097.0 |

Insight: Excluding "Other", Diesel has the highest avg mileage (\~29852) and Petrol the lowest.

***

### Multiple-columns groupby

#### transmission + fuelType — average price

```python
mdf = df.groupby(['transmission','fuelType']).agg(avg_price = ('price','mean'))
mdf
```

Out:

| transmission | fuelType |   avg\_price |
| :----------: | :------: | -----------: |
|   Automatic  |  Diesel  | 21216.705504 |
|   Automatic  | Electric | 18466.000000 |
|   Automatic  |  Hybrid  | 25543.463542 |
|   Automatic  |   Other  | 18193.861111 |
|   Automatic  |  Petrol  | 25364.465438 |
|    Manual    |  Diesel  | 13722.741104 |
|    Manual    |  Petrol  | 16299.633222 |
|   Semi-Auto  |  Diesel  | 26776.627579 |
|   Semi-Auto  |  Hybrid  | 30115.377358 |
|   Semi-Auto  |  Petrol  | 28209.395278 |

To find the highest avg price per transmission type, reset and sort:

```python
mdf = mdf.reset_index().sort_values(['transmission','fuelType'], ascending=False)
mdf
```

Out (sorted):

| transmission | fuelType |   avg\_price |
| :----------: | :------: | -----------: |
|   Semi-Auto  |  Petrol  | 28209.395278 |
|   Semi-Auto  |  Hybrid  | 30115.377358 |
|   Semi-Auto  |  Diesel  | 26776.627579 |
|    Manual    |  Petrol  | 16299.633222 |
|    Manual    |  Diesel  | 13722.741104 |
|   Automatic  |  Petrol  | 25364.465438 |
|   Automatic  |   Other  | 18193.861111 |
|   Automatic  |  Hybrid  | 25543.463542 |
|   Automatic  | Electric | 18466.000000 |
|   Automatic  |  Diesel  | 21216.705504 |

#### transmission + fuelType — avg price, total price, avg mileage

```python
mdf = df.groupby(['transmission','fuelType']).agg(
    avg_price = ('price','mean'),
    total_price = ('price','sum'),
    avg_mileage = ('mileage','mean'),
)
mdf
```

Out (truncated):

| transmission | fuelType |   avg\_price | total\_price | avg\_mileage |
| :----------: | :------: | -----------: | -----------: | -----------: |
|   Automatic  |  Diesel  | 21216.705504 |     52808380 | 36286.725191 |
|   Automatic  | Electric | 18466.000000 |        55398 | 19925.333333 |
|      ...     |    ...   |          ... |          ... |          ... |
|   Semi-Auto  |  Petrol  | 28209.395278 |     46601921 | 11222.515738 |

***

### Assignments (expandable)

<details>

<summary>Assignments: questions to answer using value_counts() and groupby()</summary>

Model

* Which model appears most frequently?
* What is the distribution of models in the dataset?
* Which model is the rarest?
* How many listings exist for each model?
* Which top 3 models dominate the dataset?

Transmission

* Count of each transmission type.
* Which transmission is most common within the dataset?
* Is manual or automatic more frequent?
* How many “Other” transmission entries exist?
* Which models have the highest number of manual entries?

Fuel Type

* Count the number of cars per fuelType.
* Which fuelType appears least?
* Compare counts of Petrol vs Diesel.
* Are there any electric (Other) entries and how many?
* Which model has the highest share of Diesel entries?

Year

* How many cars were manufactured each year?
* Which year has the highest frequency?
* Are older cars (<=2015) fewer than newer ones?
* What percentage of listings are from 2016?
* Which model has the most 2017 listings?

Tax

* Count how many listings fall under each tax value.
* Which tax bracket appears the most?
* How many listings have zero tax?
* Which models mostly fall in the high-tax range?
* Which transmission type appears the most in zero-tax cars?

Groupby: model

* What is the average price for each model?
* What is the average mileage per model?
* Which model has the highest average tax?
* Which model has the highest MPG?
* How many listings exist per model?
* What is the average engine size per model?
* Which model is the most expensive on average?
* Which model has the highest variation in price (std)?

Groupby: year

* What is the average price per year?
* Which year has the highest average mileage?
* Which year has the lowest average tax?
* How does average MPG change year-wise?
* Which year has the most total listings?
* What is the average engine size per year?
* Which year shows the steepest drop/increase in price?

Groupby: transmission

* What is the average price per transmission type?
* Which transmission type has the highest average mileage?
* Which transmission type has the highest MPG?
* Count of cars per transmission category.
* Which transmission type is the most expensive overall?

Groupby: fuelType

* What is the average price per fuel type?
* Which fuel type has the highest mileage on average?
* Which fuel type shows the highest MPG?
* Count cars per fuel type.
* Which fuel type has the highest average tax?

Groupby: engineSize

* What is the average price per engine size?
* Which engine size has the best MPG?
* Count listings per engine size.
* Which engine size has the highest tax?
* Which engine size category has the highest mileage?

Model + Transmission

* Average price per model per transmission.
* Count cars per model per transmission.
* Which model has the most automatic cars?
* Which model has the cheapest manual version?
* Price difference between manual vs automatic per model.

Model + Year

* Average mileage of each model by year.
* Count listings per model per year.
* Which model increased in price the most from 2015→2019?
* Which year has highest price variation within 3 Series?
* For 1 Series: which year has lowest average MPG?

Year + Transmission

* Count cars by year and transmission type.
* Average price per year for automatic cars.
* Which year had the highest number of manual cars?
* Mileage comparison of manual vs automatic per year.
* Which year-transmission combo is the most expensive?

Fuel Type + Model

* Average price per fuel type per model.
* Mileage differences between diesel and petrol in same model.
* Which models offer “Other” fuel and how many?
* For each model, which fuel type yields highest MPG?
* Count listings per fuel type per model.

Engine Size / MPG / Tax grouped

* Groupby engineSize: average price per engine size.
* Tax differences per fuel type.
* MPG variation per transmission.
* Highest-priced engine size per model.
* Groupby fuel type: average mileage.

</details>

***

(End of notebook content)
