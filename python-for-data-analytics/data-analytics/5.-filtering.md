# 5. Filtering

In this session we cover filtering — selecting the data you want from your dataset.

## Types of filtering

There are two types of filtering:

* iloc (index location) - filtering by index.
* loc (location) - filtering by values.

## 1. iloc

First we filter using index.

```python
import pandas as pd
df = pd.read_csv('retail_sales_dataset.csv')
df
```

|     | Customer ID | Gender | Age | Product Category | Quantity | Price per Unit |
| --- | ----------- | ------ | --- | ---------------- | -------- | -------------- |
| 0   | CUST001     | Male   | 34  | Beauty           | 3        | 50             |
| 1   | CUST002     | Female | 26  | Clothing         | 2        | 500            |
| 2   | CUST003     | Male   | 50  | Electronics      | 1        | 30             |
| 3   | CUST004     | Male   | 37  | Clothing         | 1        | 500            |
| 4   | CUST005     | Male   | 30  | Beauty           | 2        | 50             |
| ... | ...         | ...    | ... | ...              | ...      | ...            |
| 995 | CUST996     | Male   | 62  | Clothing         | 1        | 50             |
| 996 | CUST997     | Male   | 52  | Beauty           | 3        | 30             |
| 997 | CUST998     | Female | 23  | Beauty           | 4        | 25             |
| 998 | CUST999     | Female | 36  | Electronics      | 3        | 50             |
| 999 | CUST1000    | Male   | 47  | Electronics      | 4        | 30             |

1000 rows × 6 columns

### Getting any row in DataFrame

Specify the row index.

```python
df.iloc[0]  # this gets the first row
```

Out:

Customer ID CUST001\
Gender Male\
Age 34\
Product Category Beauty\
Quantity 3\
Price per Unit 50\
Name: 0, dtype: object

### Getting multiple rows in DataFrame

Specify a list of indices.

```python
df.iloc[[0, 3, 5]]
```

|   | Customer ID | Gender | Age | Product Category | Quantity | Price per Unit |
| - | ----------- | ------ | --- | ---------------- | -------- | -------------- |
| 0 | CUST001     | Male   | 34  | Beauty           | 3        | 50             |
| 3 | CUST004     | Male   | 37  | Clothing         | 1        | 500            |
| 5 | CUST006     | Female | 45  | Beauty           | 1        | 30             |

### Slicing multiple rows in DataFrame

Use Python slicing.

```python
df.iloc[2:5]
```

|   | Customer ID | Gender | Age | Product Category | Quantity | Price per Unit |
| - | ----------- | ------ | --- | ---------------- | -------- | -------------- |
| 2 | CUST003     | Male   | 50  | Electronics      | 1        | 30             |
| 3 | CUST004     | Male   | 37  | Clothing         | 1        | 500            |
| 4 | CUST005     | Male   | 30  | Beauty           | 2        | 50             |

### Getting a single value

Provide row and column index.

```python
df.iloc[0, 0]
```

Out:

'CUST001'

### Getting random rows and random columns

Specify lists of rows and columns.

```python
df.iloc[[0, 3, 5], [0, 2, 4]]
```

|   | Customer ID | Age | Quantity |
| - | ----------- | --- | -------- |
| 0 | CUST001     | 34  | 3        |
| 3 | CUST004     | 37  | 1        |
| 5 | CUST006     | 45  | 1        |

### Slicing rows and columns

You can slice both rows and columns.

```python
df.iloc[0:3, 2:4]
```

|   | Age | Product Category |
| - | --- | ---------------- |
| 0 | 34  | Beauty           |
| 1 | 26  | Clothing         |
| 2 | 50  | Electronics      |

### Getting a single column

Slice all rows and specify the column index.

```python
df.iloc[:, 1]
```

Out (truncated):

0 Male\
1 Female\
2 Male\
3 Male\
4 Male\
...\
995 Male\
996 Male\
997 Female\
998 Female\
999 Male\
Name: Gender, Length: 1000, dtype: object

Note: iloc is used to get data by index.

## 2. loc

loc filters data by values. Syntax: df.loc\[condition].

* If condition is True, rows are included.
* If condition is False, rows are excluded.

### Filter where Gender is Male

```python
mdf = df.loc[df['Gender'] == 'Male']
mdf.head()
```

|   | Customer ID | Gender | Age | Product Category | Quantity | Price per Unit |
| - | ----------- | ------ | --- | ---------------- | -------- | -------------- |
| 0 | CUST001     | Male   | 34  | Beauty           | 3        | 50             |
| 2 | CUST003     | Male   | 50  | Electronics      | 1        | 30             |
| 3 | CUST004     | Male   | 37  | Clothing         | 1        | 500            |
| 4 | CUST005     | Male   | 30  | Beauty           | 2        | 50             |
| 6 | CUST007     | Male   | 46  | Clothing         | 2        | 25             |

### Filter where Age is greater than 50

```python
fdf = df.loc[df['Age'] > 50]
fdf.head()
```

|    | Customer ID | Gender | Age | Product Category | Quantity | Price per Unit |
| -- | ----------- | ------ | --- | ---------------- | -------- | -------------- |
| 8  | CUST009     | Male   | 63  | Electronics      | 2        | 300            |
| 9  | CUST010     | Female | 52  | Clothing         | 4        | 50             |
| 13 | CUST014     | Male   | 64  | Clothing         | 4        | 30             |
| 18 | CUST019     | Female | 62  | Clothing         | 2        | 25             |
| 24 | CUST025     | Female | 64  | Beauty           | 1        | 50             |

### Multiple conditions in filtering

When combining conditions, use bitwise logical operators (not Python's and/or/not) and wrap each condition in parentheses:

* & (ampersand) — logical AND (both conditions must be true)
* \| (pipe) — logical OR (at least one condition must be true)
* != — not equal
* \~ (tilde) — bitwise NOT (negates the condition)

Always wrap each condition in parentheses when combining.

#### & — Gender is Male AND Age > 50

```python
mdf = df.loc[(df['Gender'] == 'Male') & (df['Age'] > 50)]
mdf
```

|     | Customer ID | Gender | Age | Product Category | Quantity | Price per Unit |
| --- | ----------- | ------ | --- | ---------------- | -------- | -------------- |
| 8   | CUST009     | Male   | 63  | Electronics      | 2        | 300            |
| 13  | CUST014     | Male   | 64  | Clothing         | 4        | 30             |
| 35  | CUST036     | Male   | 52  | Beauty           | 3        | 300            |
| 47  | CUST048     | Male   | 54  | Electronics      | 3        | 300            |
| 58  | CUST059     | Male   | 62  | Clothing         | 1        | 50             |
| ... | ...         | ...    | ... | ...              | ...      | ...            |
| 969 | CUST970     | Male   | 59  | Electronics      | 4        | 500            |
| 972 | CUST973     | Male   | 60  | Clothing         | 1        | 50             |
| 983 | CUST984     | Male   | 56  | Clothing         | 1        | 500            |
| 995 | CUST996     | Male   | 62  | Clothing         | 1        | 50             |
| 996 | CUST997     | Male   | 52  | Beauty           | 3        | 30             |

155 rows × 6 columns

#### & — Age between 20 and 30

```python
mdf = df.loc[(df['Age'] > 20) & (df['Age'] < 30)]
mdf.head()
```

|    | Customer ID | Gender | Age | Product Category | Quantity | Price per Unit |
| -- | ----------- | ------ | --- | ---------------- | -------- | -------------- |
| 1  | CUST002     | Female | 26  | Clothing         | 2        | 500            |
| 10 | CUST011     | Male   | 23  | Clothing         | 2        | 50             |
| 12 | CUST013     | Male   | 22  | Electronics      | 3        | 500            |
| 16 | CUST017     | Female | 27  | Clothing         | 4        | 25             |
| 19 | CUST020     | Male   | 22  | Clothing         | 3        | 300            |

#### | — Category is Clothing OR Electronics

```python
mdf = df.loc[(df['Product Category'] == 'Clothing') | (df['Product Category'] == 'Electronics')]
mdf.head()
```

|   | Customer ID | Gender | Age | Product Category | Quantity | Price per Unit |
| - | ----------- | ------ | --- | ---------------- | -------- | -------------- |
| 1 | CUST002     | Female | 26  | Clothing         | 2        | 500            |
| 2 | CUST003     | Male   | 50  | Electronics      | 1        | 30             |
| 3 | CUST004     | Male   | 37  | Clothing         | 1        | 500            |
| 6 | CUST007     | Male   | 46  | Clothing         | 2        | 25             |
| 7 | CUST008     | Male   | 30  | Electronics      | 4        | 25             |

#### != — Not equal to Electronics

```python
mdf = df.loc[df['Product Category'] != 'Electronics']
mdf.head()
```

|   | Customer ID | Gender | Age | Product Category | Quantity | Price per Unit |
| - | ----------- | ------ | --- | ---------------- | -------- | -------------- |
| 0 | CUST001     | Male   | 34  | Beauty           | 3        | 50             |
| 1 | CUST002     | Female | 26  | Clothing         | 2        | 500            |
| 2 | CUST003     | Male   | 50  | Electronics      | 1        | 30             |
| 3 | CUST004     | Male   | 37  | Clothing         | 1        | 500            |
| 4 | CUST005     | Male   | 30  | Beauty           | 2        | 50             |

#### \~ — Negation (opposite of condition)

\~ negates the condition; it returns rows for which the condition is False.

```python
mdf = df.loc[~(df['Product Category'] != 'Electronics')]
mdf.head()
```

|    | Customer ID | Gender | Age | Product Category | Quantity | Price per Unit |
| -- | ----------- | ------ | --- | ---------------- | -------- | -------------- |
| 2  | CUST003     | Male   | 50  | Electronics      | 1        | 30             |
| 7  | CUST008     | Male   | 30  | Electronics      | 4        | 25             |
| 8  | CUST009     | Male   | 63  | Electronics      | 2        | 300            |
| 12 | CUST013     | Male   | 22  | Electronics      | 3        | 500            |
| 14 | CUST015     | Female | 42  | Electronics      | 4        | 500            |

#### \~ — Negate combined condition: Gender is not male AND Category is not electronics

```python
mdf = df.loc[~((df['Gender'] == 'Male') & (df['Product Category'] == 'Electronics'))]
mdf.head()
```

|   | Customer ID | Gender | Age | Product Category | Quantity | Price per Unit |
| - | ----------- | ------ | --- | ---------------- | -------- | -------------- |
| 0 | CUST001     | Male   | 34  | Beauty           | 3        | 50             |
| 1 | CUST002     | Female | 26  | Clothing         | 2        | 500            |
| 3 | CUST004     | Male   | 37  | Clothing         | 1        | 500            |
| 4 | CUST005     | Male   | 30  | Beauty           | 2        | 50             |
| 5 | CUST006     | Female | 45  | Beauty           | 1        | 30             |
